name: Create a new release

on:
  push:
    branches:
      - fix/static_build
jobs:
  release-windows:
    name: Build for Windows
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@main
      - uses: actions-rs/toolchain@v1
      - name: Run Build
        id: build-windows
        continue-on-error: false
        uses: actions-rs/cargo@v1
        with:
          command: build
          args: >
            --config 'target.x86_64-pc-windows-msvc.pq.rustc-link-search = ["C:\\Program Files\\PostgreSQL\\14\\lib"]' 
            --config 'target.x86_64-pc-windows-msvc.pq.rustc-link-lib = ["libpq"]' 
            --release 
            --features=auth
      - name: run fastn
        run: ./target/release/fastn.exe --version
